#!/usr/bin/env nu

def main [
  --home (-h) # Only update home-manager
  --system (-s) # Only update system configuration
] {
  nix run "nixpkgs#alejandra" -- . -q
  nix run "nixpkgs#statix" -- fix .

  if not $home {
    nixos-rebuild switch --flake . --impure --use-remote-sudo --option sandbox false
  }

  if not $system {
    nix run ".#update-home" --impure
  }
}
