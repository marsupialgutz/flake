#!/usr/bin/env nu

def main [
  --home (-h) # Only update home-manager
  --system (-s) # Only update system config
] {
  nix run "nixpkgs#alejandra" -- . -q
  nix run "nixpkgs#statix" -- fix .

  if $system {
    nixos-rebuild switch --flake ".#server" --impure --use-remote-sudo --option sandbox false
  } else if $home {
    nix run ".#update-server-home" --impure
  } else {
    nixos-rebuild switch --flake ".#server" --impure --use-remote-sudo --option sandbox false
    nix run ".#update-server-home" --impure
  }
}
